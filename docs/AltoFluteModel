; Resurrection-5.0

; Notes on the terrain modelling for the AltoFlute instrument 73

; AltoFlute_x1a.params

201	247	0	0	0
;
40	1	230
0	1	246	0
0	0	0	0
;
0	0	246
0	0	246	0
0	0	0	0
;
1	0	201
0	1	246	0
0	0	0	0
;
-1	0	201
0	1	246	0
0	0	0	0
;
0	0	246
0	0	246	0
0	0	0	0
;
0	0	0	0	0
;
2	0	-0.09	0.09	0
;
0	0	0	0	0
;
1	1.54	0	0	0
;
2	1	0	0	0
;
0	0	0	0	0
;
0

The aim of this control file is to isolate the fflf region and boost its amplitude
relative to the other three case extremes, pp<lf/hf> and ffhf.

First note the index function (0b = 247) is bypassed. It return constant unity. The
actual indexing is controlled by a scalar of this generated by the group 3 index
magnitude and group 4 index offset.

The 'surface' function (0a = 201) is a linera increasing function returning [0,1].
The index magnitude in group 3 (3ai = 1) is also linear incresing on [0,1] and
directly indexes the surface function.

As the index increases the output magnitude increases. It does not however do
so directly but is modified by addition of a negative offset generated in group 4
which returns [0,-1].

The values of index and offset generated in groups 3 and 4 are controlled
dynamically by the group 6 terrain dynamic control (TDC) settings.

TDC settings which are all zero return a scalar of 1 and thus do nothing.

The group 6.3 TDC link value (6.3i = 1) specifies the TDC scalar for group 3, the
index magnitude, is amplitude-linked. The AFTDC (amplitude/frequency TDC)
scalar value compensates for the limiited amplitude range of the ff notes (the
maximum is iampix = 0.654). This amplituide index is therefore rescaled to be in
the range [0,1] by the AFTDC scalar 1.54. This is to ensure the whole range of the
function values in the specified tables is reached.

As the note amplitude increases so does the output scalar generated by table
0a.

Group 3 returns an index which is related to the note amplitude; it is at its
greatest when the note is loud.

However, this effect also applies to the pphf note, which similarly has its harmonic
amplitudes raised. This is undesirable and is eliminated by use of the the group 4
index offset, which works in reverse to the index generated in group 3.

The group 6.4 TDC link is 2 (6.4i = 2) which signifes linkage to the internal
frequency index ifrqix. This has value 0 at lf and 1 at hf, and is used to produce
a relative offset in the range [0,-1]; the value of the table output 4aiii = 201
is inverted by the negative sign of the magnitude (4ai = -1).

The resulting index is the sum of the group 3 and 4 values; the output rises with
increasing amplitude but is scaled back by increasing frequency.

The result is the isolation of the fflf region; this axis parameter file has virtually
no effect at other case extremes.

Note that an offset is applied to the final output magnitude by group 2, which
adds a constant 1 to all amplitudes produce by group 1. This is simply to ensure
some meaningul output; otherwise, since the range of amplitude scalars can
extend to zero, it would result in the disappearance of some notes!

The next consideration is that the peak in amplitudes at fflf applies to all harmonics
where in the UIOWA Altoflute note used in this reconstruction, the effect is chiefly
confined to f2 and not f<n>. We therefore have to limit the applicability of the
lf gain achieved above. 

This is accomplished by modifying the magnitude scalar in group 1. The value
generated here scales the output magnitude from the surface table 0a.

The terrain dynamic control link value for this section (6.1) is set to a non-zero
value (its actual value is ignored since the AFTD scale and offset 6.1ii and 6.1iii
are both zero) but it is merely used to enable harmonic linking (6.1iv). The value
set here is a scalar of the harmonic number (starting at f0 = 1), so as harmonic
number rises so does the value of the group 1 hTDC scalar (6.1iv).

The group 1 magnitude itself is derived from a triangle table with range [0,1]. The
idea is to index this table with the hTDC value so the desired harmonic reaches
magnitude 1 output. Clearly, a hTDC value of 0.5 would output 1, the magnitude
being less for harmonics either side. Therefore the value chosen is slightly
greater than 0.1 (the scalar here must not exceed 1 at maximum since this
parameter file only applies to 10 harmonics and the offsets whould need to be
changed if there were a different number).

Since the fundamental has harmonic number 1, this would generate an output
from the table 1aiii = 230 since its index would be greater than zero and the
magnitude of the fundamental would be changed. We therefore specify an
offset to the hTDC by adding a constant negative value to the hTDC output.
Thus the initial hTDC index starts at zero as required.

What _cannot_ be achieved with this simple schema is any alteration of the
sharpness of the peak, since we cannot alter the rate at which the surface
table is indexed, or its position, since the magnitude function is indexed in a
linear manner by harmonic number.

Due to the overall rescaling of note amplitude, the note is now considerably too
high in amplitude compared to the other three cases. It could be adjusted by
changing the constant offset 2aii but at the expense of reducing the sharpness
of the peak. spme overall rescaling is required.

This is acieved by the y axis terrain component, y1a.params. These are a copy of
the x1a table above but without the individual harmonic modification and with
the gain inverted so it reaches a minimum at fflf.

; AltoFlute_y1a.params

211	247	0	0	0
;
0.9	0	247
0	0	246	0
0	0	0	0
;
0	0.1	246
0	0	246	0
0	0	0	0
;
1	0	201
0	1	246	0
0	0	0	0
;
-1	0	201
0	1	246	0
0	0	0	0
;
0	0	246
0	0	246	0
0	0	0	0
;
0	0	0	0	0
;
0	0	0	0	0
;
0	0	0	0	0
;
1	1.54	0	0	0
;
2	1	0	0	0
;
0	0	0	0	0
;
0

Note the relative balance between the excluded cases and the fflf case is
governed bu the ratio of the magnitude (1ai = 0.9) and magnitude offset
(1bi = 0.1). This applies a default gain 0f 0.1 at fflf (which has been significantly
increased in magnitude by x1a.parms) and 1 otherwise.
